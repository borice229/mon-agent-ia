<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TalkBori</title>

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="favicon.png">

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <!-- Markdown Parser -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        body { background-color: #020617; color: #f8fafc; font-family: 'Inter', sans-serif; }

        .chat-container { 
            flex: 1; 
            display: flex; 
            flex-direction: column; 
            gap: 0.5rem; /* Espace rÃ©duit entre les bulles */
            scrollbar-width: thin; 
            scrollbar-color: #334155 transparent; 
        }

        .user-msg {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            align-self: flex-end;
            border-radius: 18px 18px 2px 18px;
        }

        .bot-msg {
            background-color: #1e293b;
            align-self: flex-start;
            border: 1px solid #334155;
            border-radius: 18px 18px 18px 18px;
        }

        .glass {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        /* Markdown styling premium */
        .bot-msg h1, .bot-msg h2, .bot-msg h3 {
            font-weight: bold;
            margin-top: 10px;
            margin-bottom: 6px;
        }

        .bot-msg ul {
            list-style: disc;
            padding-left: 20px;
            margin-top: 6px;
        }

        .bot-msg ol {
            list-style: decimal;
            padding-left: 20px;
            margin-top: 6px;
        }

        .bot-msg strong {
            color: #60a5fa;
        }

        .bot-msg code {
            background-color: #0f172a;
            padding: 2px 6px;
            border-radius: 6px;
            font-size: 0.85em;
            color: #38bdf8;
        }

        .bot-msg pre {
            background-color: #0f172a;
            padding: 10px;
            border-radius: 10px;
            overflow-x: auto;
            margin-top: 8px;
        }
    </style>
</head>

<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <div class="w-full max-w-2xl text-center mb-8 mt-4">
        <div class="w-24 h-24 bg-blue-600 rounded-full mx-auto mb-4 flex items-center justify-center text-3xl font-bold shadow-lg shadow-blue-500/20">
            BD
        </div>
        <h1 class="text-4xl font-extrabold text-white tracking-tight">
            <span class="text-blue-500">TalkBori</span>
        </h1>
        <p class="text-slate-10 mt-2">Data Analyst & Scientist </p>

        <div class="flex justify-center gap-4 mt-4">
            <a href="https://linkedin.com/in/boricedossou" target="_blank" class="p-2 bg-slate-800 rounded-lg hover:bg-blue-600 transition"><i class="fab fa-linkedin text-xl"></i></a>
            <a href="https://github.com/borice229" target="_blank" class="p-2 bg-slate-800 rounded-lg hover:bg-slate-700 transition"><i class="fab fa-github text-xl"></i></a>
            <a href="mailto:boricefiacredossou@gmail.com" class="p-2 bg-slate-800 rounded-lg hover:bg-red-500 transition"><i class="fas fa-envelope text-xl"></i></a>
            <a href="https://borice229.github.io/portfolio/" target="_blank" class="p-2 bg-slate-800 rounded-lg hover:bg-blue-600 transition"><i class="fas fa-globe text-xl"></i></a>
        </div>
    </div>

    <div class="w-full max-w-2xl glass rounded-2xl flex flex-col overflow-hidden shadow-2xl h-[70vh]">
        <div id="chat" class="chat-container p-4 flex flex-col gap-2 overflow-y-auto flex-grow">
            <div class="bot-msg p-4 max-w-[100%] text-sm leading-relaxed shadow-sm">
                Bonjour ! Je suis le jumeau numÃ©rique de Borice DOSSOU. 
                Je connais son parcours, ses projets Data et ses compÃ©tences.
                Que voulez-vous savoir ðŸ˜Š?
            </div>
        </div>

    
        <div class="p-4 border-t border-slate-700 bg-slate-900/50 flex gap-2">
            <input id="userInput" type="text" placeholder="Posez une question..."
                   class="flex-1 bg-slate-800 border border-slate-700 p-3 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 transition">

            <button id="sendBtn"
                    class="bg-blue-600 hover:bg-blue-500 p-3 rounded-xl transition flex items-center justify-center w-12">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>

    </div>

<script>

    // Configuration Markdown
    marked.setOptions({
        breaks: true,
        gfm: true
    });

    let sessionId = localStorage.getItem("borice_sid") || crypto.randomUUID();
    localStorage.setItem("borice_sid", sessionId);

    const chatDiv = document.getElementById("chat");
    const userInput = document.getElementById("userInput");
    const sendBtn = document.getElementById("sendBtn");

    function appendMessage(sender, text, className, isBot=false) {
        const msgDiv = document.createElement("div");
        msgDiv.className = `p-4 max-w-[85%] text-sm leading-relaxed shadow-sm ${className}`;

        const header = `
            <span class="block text-xs opacity-50 mb-1 font-bold uppercase tracking-wider">
                ${sender}
            </span>
        `;

        if (isBot) {
            msgDiv.innerHTML = header + marked.parse(text);
        } else {
            msgDiv.innerHTML = header + text;
        }

        chatDiv.appendChild(msgDiv);
        chatDiv.scrollTop = chatDiv.scrollHeight;
    }

    async function sendMessage() {
        const message = userInput.value.trim();
        if (!message) return;

        appendMessage("Vous", message, "user-msg text-white");
        userInput.value = "";

        try {
            const response = await fetch("http://127.0.0.1:8000/chat", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ message: message, sessionId: sessionId })
            });

            const data = await response.json();

            appendMessage("Borice IA", data.reply, "bot-msg", true);

        } catch (e) {
            appendMessage("Erreur", "VÃ©rifiez que le serveur Python tourne bien !", "bot-msg text-red-400");
        }
    }

    sendBtn.addEventListener("click", sendMessage);
    userInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter") sendMessage();
    });

</script>

</body>
</html>